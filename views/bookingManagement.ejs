<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Booking Management</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css">
	</head>

	<body>
		<h1>Booking Management</h1>
			<h2>Booking Lookup</h3>
			<div>
				<form action="bookingManagement" method="POST">
					<label for="id">Booking ID:</label>
					<input type="text" placeholder="123567890" name="id"/>
					<label for="email">Email:</label>
					<input type="text" placeholder="email@email.com" name="email"/>
					<label for="date">Date:</label>
					<input type="date" name="date"/>
					<input type="submit" value="Search" />
				</form>
				<form action="bookingManagement" method="GET">
					<input type="submit" value="Clear Search">
				</form>
			</div>
		
			<h2>Bookings</h2>
            <table>
				<th>ID</th>
				<th>First Name</th>
				<th>Last Name</th>
				<th>Email</th>
				<th>Phone</th>
				<th>Date</th>
				<th>Time</th>
				<th>Attendees No.</th>
                <th>Total Paid</th>
                <th></th><th></th>
				<% var idCounter = 0; %>
				<% bookings.forEach(booking => { %>
					<% idCounter++; %>
				<tr>
					<td><%=booking._id %></td>
					<td><%=booking.f_name%></td>
					<td><%=booking.l_name%></td>
					<td><%=booking.email%></td>
					<td><%=booking.phone%></td>
					<td>
						<input id="dateInput<%=idCounter%>" type="hidden" value="<%=booking.date_time%>">
						<span id="dateSpan<%=idCounter%>">
							<%=booking.date_time.toLocaleString([], {year:
							'numeric', month: 'numeric', day:'numeric'})%>
						</span>
					</td>
                    <td>
						<select id="timeInput<%=idCounter%>" style="display: none" value="<%=booking.date_time.getHours()%>">
							<option>10:00 AM</option>
							<option>11:00 AM</option>
							<option>12:00 PM</option>
							<option>13:00 PM</option>
							<option>14:00 PM</option>
							<option>15:00 PM</option>
						</select>
                        <span id="timeSpan<%=idCounter%>">
							<%=booking.date_time.toLocaleString([], {hour:
							'2-digit', minute:'2-digit', hour12: false})%>
						</span>
                    </td>
					<td><%=booking.attendees_no%></td>
                    <td><%='$'+booking.total_price%></td>
                    <td>
						<button id="edit" onclick="edit(<%=idCounter%>)">Edit</button>
					</td>
                    <td>
						<form action="bookingManagement/delete/<%=booking._id%>" method="POST">
						<button id="cancel" onclick="return confirm('Are you sure you want to cancel this booking?')">Cancel</button>
						</form>
					</td>
				</tr>
				<% }); %>
			</table>

			<script>
				async function edit(x) {
					dateSpan = document.getElementById("dateSpan" + x);
					timeSpan = document.getElementById("timeSpan" + x);

					dateInput = document.getElementById("dateInput" + x);
					timeInput = document.getElementById("timeInput" + x);

					editBtn = document.getElementById("edit" + x);

					dateSpan.style.display = "none";
					timeSpan.style.display = "none";

					dateInput.style.display = "inline";
					timeInput.style.display = "inline";

					dateInput.type = "date";
					
				}
			</script>
	</body>
</html>
